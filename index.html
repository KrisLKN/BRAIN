<!DOCTYPE html>
<html lang="fr">
<head>
  <!-- META & PWA -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="description" content="Second Cerveau OS â€” productivitÃ©, santÃ©, IA, objectifs, calendrier, fichiers, connaissances, humeur, mÃ©tÃ©o et plus." />
  <meta name="theme-color" content="#0f172a" media="(prefers-color-scheme: dark)" />
  <meta name="theme-color" content="#ffffff"  media="(prefers-color-scheme: light)" />
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="apple-touch-icon" href="icons/icon-192.png" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <title>ğŸ§  Second Cerveau OS</title>

  <!-- Styles -->
  <link rel="preload" href="styles.css" as="style" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
<div id="app" class="app-wrapper">

  <!-- SPLASH / LOGIN -->
  <div id="splash-screen" role="dialog" aria-label="Ã‰cran de dÃ©marrage">
    <div class="splash-card glass">
      <div class="logo">ğŸ§ </div>
      <h1>Second Cerveau OS</h1>
      <p>Chargement de ton universâ€¦</p>
      <div class="login-card">
        <input id="userName" placeholder="Ton nom" aria-label="Nom d'utilisateur" />
        <button id="loginBtn" class="btn primary">Entrer</button>
      </div>
      <small class="muted">Ton nom est stockÃ© localement (aucun cloud).</small>
    </div>
  </div>

  <!-- HEADER -->
  <header class="app-header glass">
    <div class="profile">
      <img id="profilePic" src="icons/user.png" alt="Photo de profil" />
      <div class="profile-meta">
        <span id="profileName">Utilisateur</span>
        <small id="profileTagline">CrÃ©e ta meilleure version</small>
      </div>
    </div>
    <div class="header-actions">
      <button id="themeToggle" class="icon" title="ThÃ¨me">ğŸŒ—</button>
      <button id="backupBtn" class="icon" title="Exporter toutes les donnÃ©es">â¤´ï¸</button>
      <button id="settingsBtn" class="icon" data-tab="settings" title="RÃ©glages">âš™ï¸</button>
    </div>
  </header>

  <!-- CONTENU -->
  <main class="tab-container">

    <!-- DASHBOARD -->
    <section id="dashboard" class="tab active" aria-label="Vue dâ€™ensemble">
      <h2 class="section-title">Vue dâ€™ensemble</h2>

      <!-- Bandeaux rapides -->
      <div class="row wrap">
        <div class="chip">ğŸ“… Aujourdâ€™hui : <b id="todayLabel"></b></div>
        <div class="chip">â±ï¸ Focus : <b id="focusMini">00:00</b></div>
        <div class="chip">âš¡ Streak : <b id="streakCounter">0</b></div>
        <div class="chip">ğŸ”” Rappels : <b id="reminderCount">0</b></div>
      </div>

      <!-- Widgets -->
      <div class="widget-grid">
        <article class="widget glass interactive" id="w-lastNote">
          <header><h3>ğŸ““ DerniÃ¨re note</h3><button class="mini" data-open="journal">Ouvrir</button></header>
          <p class="truncate">â€”</p>
        </article>

        <article class="widget glass interactive" id="w-tasks">
          <header><h3>âœ… TÃ¢ches</h3><div class="mini-row"><span class="mini pill" id="taskQuickAdd">+ Rapide</span><button class="mini" data-open="tasks">Voir</button></div></header>
          <p><b id="tasksOpen">0</b> Ã  faire â€¢ <span id="tasksToday">0</span> aujourdâ€™hui</p>
          <div class="progress"><div id="tasksProgress" style="width:0%"></div></div>
        </article>

        <article class="widget glass interactive" id="w-habits">
          <header><h3>ğŸ”¥ Habitudes</h3><button class="mini" data-open="habits">Voir</button></header>
          <p><b id="habitsDoneToday">0</b> complÃ©tÃ©es aujourdâ€™hui</p>
        </article>

        <article class="widget glass" id="w-focus">
          <header><h3>â³ Focus</h3><button class="mini" data-open="focus">Lancer</button></header>
          <p>DerniÃ¨re session : <span id="lastFocus">â€”</span></p>
        </article>

        <article class="widget glass span-2" id="w-health">
          <header><h3>ğŸ“Š SantÃ©</h3><div class="mini pill">Pas / Poids / Sommeil</div></header>
          <canvas id="healthChart" height="150" aria-label="Graphique santÃ©"></canvas>
        </article>

        <article class="widget glass" id="w-nutrition">
          <header><h3>ğŸ¥— Nutrition</h3><button class="mini" data-open="nutrition">Ajouter</button></header>
          <p>Aujourdâ€™hui : <b id="kcalToday">0</b> kcal</p>
        </article>

        <article class="widget glass" id="w-hydration">
          <header><h3>ğŸ’§ Hydratation</h3><button class="mini" id="waterPlus">+1 verre</button></header>
          <p><b id="waterCount">0</b> verres</p>
        </article>

        <article class="widget glass" id="w-goal">
          <header><h3>ğŸ¯ Objectif clÃ©</h3><button class="mini" data-open="goals">GÃ©rer</button></header>
          <p id="mainGoal">â€”</p>
          <div class="progress"><div id="goalProgress" style="width:0%"></div></div>
        </article>

        <article class="widget glass" id="w-mood">
          <header><h3>ğŸ˜Š Humeur</h3><button class="mini" data-open="mood">Saisir</button></header>
          <p id="moodNow">â€”</p>
        </article>

        <article class="widget glass" id="w-quote">
          <header><h3>ğŸ’¬ Citation</h3><button class="mini" id="refreshQuote">â†»</button></header>
          <p id="quoteTxt">â€”</p>
        </article>

        <article class="widget glass" id="w-weather">
          <header><h3>â˜€ï¸ MÃ©tÃ©o</h3><button class="mini" id="refreshWeather">â†»</button></header>
          <p id="weatherNow">â€”</p>
        </article>

        <article class="widget glass" id="w-news">
          <header><h3>ğŸ“° Actus</h3><button class="mini" data-open="resources">Sources</button></header>
          <ul id="newsList" class="mini-list"></ul>
        </article>

        <article class="widget glass" id="w-finance">
          <header><h3>ğŸ’¹ Finance</h3><button class="mini" id="refreshFinance">â†»</button></header>
          <p id="financeNow">â€”</p>
        </article>
      </div>

      <!-- Raccourcis -->
      <div class="quick-actions glass">
        <button class="btn" data-open="journal">+ Note</button>
        <button class="btn" data-open="tasks">+ TÃ¢che</button>
        <button class="btn" data-open="habits">+ Habitude</button>
        <button class="btn" data-open="focus">â–¶ï¸ Focus</button>
        <button class="btn" data-open="nutrition">+ Repas</button>
        <button class="btn" data-open="mood">ğŸ˜Š Humeur</button>
      </div>
    </section>

    <!-- JOURNAL (dÃ©taillÃ©) -->
    <section id="journal" class="tab" aria-label="Journal">
      <h2 class="section-title">Journal</h2>

      <div class="card glass">
        <form id="journalForm" class="stack">
          <div class="row wrap">
            <input id="journalTitle" placeholder="Titre" />
            <input id="journalTags"  placeholder="#tags (sÃ©parÃ©s par espace)" />
            <input id="journalDate"  type="date" />
          </div>
          <textarea id="journalText" placeholder="Note rapide, idÃ©e, souvenirâ€¦"></textarea>
          <div class="row wrap">
            <button class="btn primary">Ajouter</button>
            <button type="button" id="journalVoice" class="btn">ğŸ™ï¸ DictÃ©e</button>
            <button type="button" id="journalImport" class="btn">â¬‡ï¸ Import</button>
            <button type="button" id="journalExport" class="btn">â¬†ï¸ Export .md</button>
            <input id="journalSearch" placeholder="Rechercherâ€¦" />
            <select id="journalFilter">
              <option value="">Tout</option><option value="today">Aujourdâ€™hui</option><option value="week">Cette semaine</option><option value="tag">Par tagâ€¦</option>
            </select>
          </div>
        </form>
      </div>

      <ul id="journalList" class="list"></ul>

      <!-- Ã‰dition modale -->
      <dialog id="journalModal" class="modal glass">
        <form method="dialog" class="stack">
          <h3>Modifier la note</h3>
          <input id="editJTitle" placeholder="Titre" />
          <input id="editJTags"  placeholder="#tags" />
          <textarea id="editJText" placeholder="Contenuâ€¦"></textarea>
          <div class="row">
            <button value="cancel" class="btn">Annuler</button>
            <button id="saveJournalEdit" value="default" class="btn primary">Enregistrer</button>
          </div>
        </form>
      </dialog>
    </section>

    <!-- TÃ‚CHES (pro) -->
    <section id="tasks" class="tab" aria-label="TÃ¢ches">
      <h2 class="section-title">TÃ¢ches</h2>

      <div class="card glass">
        <form id="taskForm" class="row wrap">
          <input id="taskTitle" placeholder="Nouvelle tÃ¢che" required />
          <input id="taskDue" type="date" title="Ã‰chÃ©ance" />
          <select id="taskProject" title="Projet">
            <option value="">Projet</option><option>Perso</option><option>Travail</option><option>Ã‰tudes</option>
          </select>
          <select id="taskPriority" title="PrioritÃ©">
            <option value="moyenne">PrioritÃ©</option><option value="basse">Basse</option><option value="moyenne">Moyenne</option><option value="haute">Haute</option>
          </select>
          <button class="btn primary">Ajouter</button>
        </form>
      </div>

      <div class="toolbar row wrap">
        <input id="taskSearch" placeholder="Rechercherâ€¦" />
        <select id="taskFilter">
          <option value="">Tous statuts</option><option value="todo">Ã€ faire</option><option value="doing">En cours</option><option value="done">Fait</option>
        </select>
        <select id="taskSort">
          <option value="created_desc">RÃ©cent</option><option value="due_asc">Ã‰chÃ©ance â†‘</option><option value="priority_desc">PrioritÃ©</option>
        </select>
        <button id="taskClearDone" class="btn">Purger Â« Fait Â»</button>
        <button id="taskBulkToday" class="btn">Planifier pour aujourdâ€™hui</button>
        <button id="taskExportCSV" class="btn">Exporter CSV</button>
      </div>

      <div class="kanban">
        <div class="kan-col"><h3>Ã€ faire</h3><ul id="todoList"  class="list can-drop"></ul></div>
        <div class="kan-col"><h3>En cours</h3><ul id="doingList" class="list can-drop"></ul></div>
        <div class="kan-col"><h3>Fait</h3><ul id="doneList"  class="list can-drop"></ul></div>
      </div>

      <!-- Modale dâ€™Ã©dition tache -->
      <dialog id="taskModal" class="modal glass">
        <form method="dialog" class="stack">
          <h3>Modifier la tÃ¢che</h3>
          <input id="editTTitle" placeholder="Titre" />
          <input id="editTDue" type="date" />
          <select id="editTProject">
            <option value="">Projet</option><option>Perso</option><option>Travail</option><option>Ã‰tudes</option>
          </select>
          <select id="editTPriority">
            <option value="basse">Basse</option><option value="moyenne" selected>Moyenne</option><option value="haute">Haute</option>
          </select>
          <div class="row">
            <button value="cancel" class="btn">Annuler</button>
            <button id="saveTaskEdit" value="default" class="btn primary">Enregistrer</button>
          </div>
        </form>
      </dialog>
    </section>

    <!-- HABITUDES -->
    <section id="habits" class="tab" aria-label="Habitudes">
      <h2 class="section-title">Habitudes</h2>
      <div class="card glass">
        <form id="habitForm" class="row">
          <input id="habitName" placeholder="Nom de lâ€™habitude" />
          <button class="btn primary">Ajouter</button>
        </form>
      </div>
      <div class="row wrap">
        <div class="chip">Aujourdâ€™hui : <b id="habitTodayCount">0</b></div>
        <div class="chip">Streak max : <b id="habitMaxStreak">0</b></div>
      </div>
      <ul id="habitList" class="list grid"></ul>
    </section>

    <!-- FOCUS -->
    <section id="focus" class="tab" aria-label="Focus">
      <h2 class="section-title">Focus</h2>
      <div class="focus-panel glass">
        <div class="timer" id="focusTimer">25:00</div>
        <div class="row">
          <button id="focusStart" class="btn primary">DÃ©marrer</button>
          <button id="focusStop" class="btn">Stop</button>
          <button id="focusReset" class="btn">Reset</button>
        </div>
      </div>
      <ul id="focusStats" class="list"></ul>
    </section>

    <!-- SANTÃ‰ -->
    <section id="metrics" class="tab" aria-label="SantÃ©">
      <h2 class="section-title">SantÃ©</h2>
      <div class="card glass stack">
        <p>Importer Apple SantÃ© (export.xml)</p>
        <input id="healthFile" type="file" accept=".xml" />
        <button id="parseHealth" class="btn primary">Analyser</button>
      </div>
      <div id="healthSummary" class="card glass"></div>
    </section>

    <!-- OBJECTIFS -->
    <section id="goals" class="tab" aria-label="Objectifs">
      <h2 class="section-title">Objectifs</h2>
      <form id="goalForm" class="card glass row wrap">
        <input id="goalTitle"  placeholder="Objectif" />
        <input id="goalTarget" type="number" placeholder="Valeur cible" />
        <button class="btn primary">Ajouter</button>
      </form>
      <ul id="goalList" class="list grid"></ul>
    </section>

    <!-- NUTRITION -->
    <section id="nutrition" class="tab" aria-label="Nutrition">
      <h2 class="section-title">Nutrition</h2>
      <form id="nutriForm" class="card glass row wrap">
        <input id="nutriFood" placeholder="Aliment" />
        <input id="nutriKcal" type="number" placeholder="kcal" />
        <button class="btn primary">Ajouter</button>
      </form>
      <ul id="nutriList" class="list"></ul>
    </section>

    <!-- HUMEUR -->
    <section id="mood" class="tab" aria-label="Humeur">
      <h2 class="section-title">Humeur</h2>
      <div class="card glass row wrap">
        <select id="moodSelect">
          <option>ğŸ˜Š Heureux</option><option>ğŸ˜ Neutre</option><option>ğŸ˜” FatiguÃ©</option><option>ğŸ˜¡ StressÃ©</option>
        </select>
        <button id="saveMood" class="btn primary">Enregistrer</button>
      </div>
      <div id="moodHistory" class="card glass"></div>
    </section>

    <!-- ASSISTANT IA -->
    <section id="assistant" class="tab" aria-label="Assistant IA">
      <h2 class="section-title">Assistant IA</h2>
      <div class="card glass stack">
        <textarea id="assistantInput" placeholder="Pose ta questionâ€¦ (ex: combien de tÃ¢ches restantes ?)"></textarea>
        <div class="row">
          <button id="askAssistant" class="btn primary">Envoyer</button>
          <button id="assistantClear" class="btn">Effacer</button>
        </div>
      </div>
      <div id="assistantChat" class="chat list"></div>
    </section>

    <!-- CALENDRIER -->
    <section id="calendar" class="tab" aria-label="Calendrier">
      <h2 class="section-title">Calendrier</h2>
      <div id="calendarContainer" class="card glass">Ã€ connecter (ics, CalDAVâ€¦)</div>
    </section>

    <!-- RESSOURCES -->
    <section id="resources" class="tab" aria-label="Ressources">
      <h2 class="section-title">Ressources & Liens</h2>
      <form id="resourceForm" class="card glass row wrap">
        <input id="resourceTitle" placeholder="Titre" />
        <input id="resourceLink"  placeholder="Lien" />
        <button class="btn primary">Ajouter</button>
      </form>
      <ul id="resourceList" class="list"></ul>
    </section>

    <!-- FICHIERS -->
    <section id="files" class="tab" aria-label="Fichiers">
      <h2 class="section-title">Fichiers</h2>
      <div class="card glass row wrap">
        <input id="fileUpload" type="file" multiple />
        <button id="saveFile" class="btn primary">Uploader</button>
      </div>
      <ul id="fileList" class="list grid"></ul>
    </section>

    <!-- CARTE -->
    <section id="map" class="tab" aria-label="Carte">
      <h2 class="section-title">Carte des souvenirs</h2>
      <div id="mapView" class="card glass map-placeholder">ğŸ—ºï¸ Carte (Ã  connecter)</div>
    </section>

    <!-- RECHERCHE -->
    <section id="search" class="tab" aria-label="Recherche">
      <h2 class="section-title">Recherche globale</h2>
      <div class="card glass row wrap">
        <input id="searchInput" placeholder="Rechercher partoutâ€¦" />
        <button id="searchBtn" class="btn">ğŸ”</button>
        <small class="muted">Cherche dans notes, tÃ¢ches, habitudesâ€¦</small>
      </div>
      <div id="searchResults" class="list"></div>
    </section>

    <!-- PARAMÃˆTRES -->
    <section id="settings" class="tab" aria-label="ParamÃ¨tres">
      <h2 class="section-title">ParamÃ¨tres</h2>
      <div class="grid-2">
        <div class="card glass stack">
          <h3>Apparence</h3>
          <div class="row wrap">
            <button id="themeLight" class="btn">Clair</button>
            <button id="themeDark"  class="btn">Sombre</button>
            <button id="themeAmoled"class="btn">AMOLED</button>
          </div>
          <label class="row"><input type="checkbox" id="reduceMotion" /> RÃ©duire les animations</label>
        </div>

        <div class="card glass stack">
          <h3>Sauvegarde</h3>
          <div class="row wrap">
            <button id="exportData" class="btn">Exporter JSON</button>
            <input id="importData" type="file" accept=".json" />
          </div>
          <small class="muted">Les donnÃ©es restent sur lâ€™appareil (IndexedDB/LocalStorage).</small>
        </div>

        <div class="card glass stack">
          <h3>ConfidentialitÃ©</h3>
          <button id="lockApp"  class="btn">Activer verrouillage (Face ID)</button>
          <button id="panicMode" class="btn danger">Mode voyage</button>
        </div>

        <div class="card glass stack">
          <h3>Synchronisation</h3>
          <button id="syncNow" class="btn">Sync manuelle</button>
          <small>Ã€ venir : Supabase, iCloud Drive, Raccourcis Siri, Notifications.</small>
        </div>
      </div>
    </section>

  </main>

  <!-- DOCK -->
  <nav class="dock glass" role="navigation" aria-label="Navigation principale">
    <button data-tab="dashboard" class="active">ğŸ <span>Accueil</span></button>
    <button data-tab="journal">ğŸ““<span>Journal</span></button>
    <button data-tab="tasks">âœ…<span>TÃ¢ches</span></button>
    <button data-tab="habits">ğŸ”¥<span>Habitudes</span></button>
    <button data-tab="focus">â³<span>Focus</span></button>
    <button data-tab="metrics">ğŸ“Š<span>SantÃ©</span></button>
    <button data-tab="goals">ğŸ¯<span>Objectifs</span></button>
    <button data-tab="nutrition">ğŸ¥—<span>Nutrition</span></button>
    <button data-tab="mood">ğŸ˜Š<span>Humeur</span></button>
    <button data-tab="assistant">ğŸ¤–<span>IA</span></button>
    <button data-tab="calendar">ğŸ“…<span>Agenda</span></button>
    <button data-tab="resources">ğŸ“š<span>Ressources</span></button>
    <button data-tab="files">ğŸ“‚<span>Fichiers</span></button>
    <button data-tab="map">ğŸ—ºï¸<span>Carte</span></button>
    <button data-tab="search">ğŸ”<span>Recherche</span></button>
    <button data-tab="settings">âš™ï¸<span>RÃ©glages</span></button>
  </nav>

  <!-- TEMPLATES (pour rendu rapide cÃ´tÃ© JS si besoin) -->
  <template id="tpl-task">
    <li class="card glass draggable">
      <div class="row space-between">
        <div class="task-title"></div>
        <div class="row">
          <small class="task-meta muted"></small>
          <button class="btn mini edit">âœï¸</button>
          <button class="btn mini danger del">ğŸ—‘</button>
        </div>
      </div>
    </li>
  </template>

</div>

<!-- JS -->
<script src="db.js"></script>
<script src="app.js"></script>
<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('./sw.js').catch(console.error);
  }
</script>
</body>
</html>
